/**
 * Panda.js
 * Extendable Client side syntax highlighter core javascript and API. No languages included.
 *
 * Copyright 2011-2012 AvacWeb (avacweb.com)
 * Released under the MIT and GPL Licenses.
 */
(function(){function n(b,a){return a?b.replace(/\n/g,"<br/>"):b.replace(/\<br\s?\/?\>/g,"\n")}function o(b,a,c){return b.replace(RegExp("\\b(?:"+a.join("|")+")\\b","g"),function(a){return'<span clapanda="'+c+'">'+a+"</span>"})}var f={lineNumbering:!0,cacheIdentity:!0,languages:[],regex:{comment1:/\/\/[^\n]*/g,comment2:/\/\*(.|[\n\r])*?\*\//gm,comment3:/#[^\n]*(?=\n|$)/g,string:/(['"])(?:\\?.)*?\1/g,operators:/(?:(!|=)?==?)|(?:\|\|)|[\-\+\>\/\*%]|&(amp;)?&(amp;)?/g,extra:/[:\{\}\[\]\(\)]/g},parse:function(b,a){var c=f[b];if(!c)return a;for(var e=c.matchers,d=c.keywords,i=c.specials,l=(new Date).getTime(),c={},a=n(a.replace(/\</g,"&lt;")),h=0,g=e[0],j=0;g;g=e[++h]){var k=this.regex[g],p="#"+g+"_"+l+"_",q=c[g]={};k&&(a=a.replace(k,function(a){var b=p+j++ +"_"+(k.multiline?"m_":"")+"#";q[b]=a;return b}))}d.length&&(a=o(a,d,"panda-keyword"));i.length&&(a=o(a,i,"panda-special"));for(h=e.length;h;h--){var g=e[h-1],d=c[g],m;for(m in d)i=d[m],m.indexOf("_m_#")&&(i=i.replace(/\n/g,'</span>\n<span clapanda="panda-'+g+'">')),a=a.replace(m,'<span clapanda="panda-'+g+'">'+i+"</span>")}a=a.replace(/ /g,"&nbsp;").replace(/&nbsp;clapanda=/g," class=");this.lineNumbering&&(a='<ol class="pandaCode"><li>'+a.split(/\n/).join("</li><li>")+"</li></ol>");return n(a.replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;"),1)},colorNode:function(b){var a=b.pandaType||f.identify(b);a&&(f.cacheIdentity&&(b.pandaType=a),b.className=b.className?b.className+" panda-code":"panda-code",b.innerHTML=f.parse(a,b.innerHTML))},identify:function(b){if(b.pandaType)return b.pandaType;var a=/(?:\s|^)panda_(\w+)(?:\s|$)/;if(a.test(b.className))return a.exec(b.className)[1];var a={},c=f.regex,b=b.innerHTML,e=f.languages,d;for(d in c)"extra"==d||("operators"==d||"string"==d)||(a[d]=(b.match(c[d])||[]).length);d=0;for(var c=e.length,i=0,l=null;d<c;d++){for(var h=0,g=f[e[d]],j=0,k=g.matchers.length;j<k;j++)h+=a[g.matchers[j]];h+=(b.match(RegExp("\\W("+g.keywords.join("|")+")\\W"))||[]).length;h>i&&(i=h,l=e[d])}return l},addSpecials:function(b,a){this.addKeywords(b,a,!0)},addKeywords:function(b,a,c){if(b in f)for(var e=0,d=a.length;e<d;e++)f[b][c?"specials":"keywords"].push(a[e])},addLang:function(b,a){if("matchers"in a){var c=f[b]={};f.languages.push(b);c.matchers="string"==typeof a.matchers?a.matchers.split(" "):a.matchers;c.specials=("string"==typeof a.specials?a.specials.split(" "):a.specials)||[];c.keywords=("string"==typeof a.keywords?a.keywords.split(" "):a.keywords)||[];if(a.regex&&"object"==typeof a.regex)for(var e in a.regex)f.regex[e]=a.regex[e]}}};"object"===typeof module&&"object"===typeof module.exports?module.exports=f:window.panda=f})();