/**
 * Panda.js
 * Client side syntax highlighter for HTML, CSS and Javascript
 *
 * Copyright 2011-2012 AvacWeb (avacweb.com)
 * Released under the MIT and GPL Licenses.
 */
(function(){function n(b,a){return a?b.replace(/\n/g,"<br/>"):b.replace(/\<br\s?\/?\>/g,"\n")}function o(b,a,d){return b.replace(RegExp("(?:^|\\W)("+a.join("|")+")(?:\\W)","g"),function(a,b){return a.replace(b,'<span class="'+d+'">'+b+"</span>")})}var b={lineNumbering:!0,languages:["js","html","css","php"],js:{},html:{},css:{},php:{},regex:{regex:/\/(.(?!\\\/)).*\//g,comment1:/(?!:(?=\/))[^:]\/\/[^\n]*/g,comment2:/\/\*(.|[\n\r])*?\*\//gm,comment3:/#[^\n]*/g,comment4:/(&lt;|<)!--.*?--(&gt;|>)/g,string1:/"(\\"|[^"])*"/g,string2:/'(\\'|[^'])*'/g,multiLineString1:/"(\\"|[^"])*"/gm,multiLineString2:/'(\\'|[^'])*'/gm,phptag:/((?:<|&lt;)\?(php)?)|(?:\?(?:>|&gt;))/g,htmltag:/(?:&lt;|\<).+?(?:&gt;|\>)/g,htmlspecial:/(?:&lt;|\<)\/?(head|html|body|a|script|meta|link)#?.*?(?:&gt;|\>)/g,operators:/(?:(!|=)?==?)|(?:\|\|)|[\-\+\>\/\*%]/g,attribute:/\s[\w\-]+(?==["'].*?['"])/g,phpvar:/\$[\w\d_]+(?=\W)/g,selector:/.*?(?=\s*\{)/g,extra:/[:\{\}\[\]\(\)]/g}};b.js.keywords="var function return if else while do this new typeof for null false true".split(" ");b.js.specials="document window Array RegExp Object Math String Number Date".split(" ");b.js.matchers="comment1 comment2 string1 string2 regex operators extra".split(" ");b.html.keywords=b.html.specials=[];b.html.matchers=["comment4","attribute","htmlspecial","htmltag"];b.php.keywords="var function private public static if else return while do this new typeof for foreach as null false true".split(" ");b.php.specials="echo require include int array global".split(" ");b.php.matchers="comment3 comment2 comment1 multiLineString1 multiLineString2 phpvar phptag operators extra".split(" ");b.css.keywords=b.css.specials=[];b.css.matchers=["comment2","string1","string2","selector","extra"];b.parse=function(c,a){var d=b[c];if(!d)return a;for(var f=d.matchers,h=d.keywords,j=d.specials,l=(new Date).getTime(),d={},a=n(a.replace(/(^[\s\t\n]+)|([\s\t\n]+$)/g,"")),i=0,e=f.length;i<e;i++){var g=f[i],k=this.regex[g],p="#"+g+"_"+l+"_",q=0,r=d[g]={};k&&(a=a.replace(k,function(a){var b=p+q++ +"_"+(k.multiline?"m":"")+"#";r[b]=a;return b}))}h.length&&(a=o(a,h,"panda-keyword"));j.length&&(a=o(a,j,"panda-special"));for(i=f.length;i;i--){var g=f[i-1],h=d[g],m;for(m in h)j=h[m],m.indexOf("_m_#")&&(j=j.replace(/\n/g,'</span>\n<span class="panda-'+g+'">')),a=a.replace(m,'<span class="panda-'+g+'">'+j+"</span>")}this.lineNumbering&&(a='<ol class="pandaCode"><li>'+a.split(/\n/).join("</li><li>")+"</li></ol>");return n(a.replace(/\t|(    )/g,"&nbsp;&nbsp;&nbsp;&nbsp;"),1)};b.colorNode=function(c){var a=b.identify(c);if(a){if("code"==c.nodeName.toLowerCase()&&"pre"!=c.parentNode.nodeName.toLowerCase()){var d=document.createElement("pre");c.parentNode.insertBefore(d,c);d.appendChild(c)}c.innerHTML=b.parse(a,c.innerHTML)}};b.identify=function(c){var a=/(?:\s|^)panda_(\w+)(?:\s|$)/;if(a.test(c.className))return a.exec(c.className)[1];var a={},d=b.regex,c=c.innerHTML,f=b.languages,h=0,j=f.length,l=0,i=null,e;for(e in d)a[e]=(c.match(d[e])||[]).length;for(;h<j;h++){e=0;for(var d=b[f[h]],g=0,k=d.matchers.length;g<k;g++)e+=a[d.matchers[g]];e+=(c.match(RegExp(d.keywords.join("|")))||[]).length;e>l&&(l=e,i=f[h])}return i};b.addKeyword=function(c,a){b[c].keywords.push(a)};b.addSpecial=function(c,a){b[c].specials.push(a)};b.addLang=function(c,a){if("matchers"in a&&"keywords"in a&&"specials"in a){var d=b[c]={};b.languages.push(c);d.matchers="string"==typeof a.matchers?a.matchers.split(" "):a.matchers;d.specials="string"==typeof a.specials?a.specials.split(" "):a.specials;d.keywords="string"==typeof a.keywords?a.keywords.split(" "):a.keywords;if(a.regex&&"object"==typeof a.regex)for(var f in a.regex)b.regex[f]=a.regex[f]}};"object"===typeof module&&"object"===typeof module.exports?module.exports=b:window.panda=b})();